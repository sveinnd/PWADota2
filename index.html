<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dota 2 Heroes</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #111;
      color: white;
    }

    .hero-card {
      margin-bottom: 20px;
    }

    .filter-attr img {
      width: 24px;
      filter: grayscale(100%);
      transition: 0.2s ease;
    }

    .filter-attr:hover img,
    .filter-attr.active img {
      filter: none;
      transform: scale(1.1);
    }

    .card {
      background-color: #1e1e1e;
      border: none;
    }

    .card-title {
      font-weight: bold;
    }

    .btn.filter-role {
      margin: 2px;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center mb-4">Dota 2 Heroes</h1>

    <!-- Filter by Primary Attribute -->
    <div class="text-center mb-2">
      <button class="btn btn-outline-secondary filter-attr" data-attr="str">
        <img src="icons/str.png" alt="STR">
      </button>
      <button class="btn btn-outline-secondary filter-attr" data-attr="agi">
        <img src="icons/agi.png" alt="AGI">
      </button>
      <button class="btn btn-outline-secondary filter-attr" data-attr="int">
        <img src="icons/int.png" alt="INT">
      </button>
      <button class="btn btn-outline-secondary filter-attr" data-attr="all">
        <img src="icons/universal.png" alt="Universal">
      </button>
      <button class="btn btn-outline-danger reset-filters ms-2">Reset</button>
    </div>

    <!-- Filter by Roles -->
    <div class="text-center mb-3">
      <button class="btn btn-outline-light filter-role" data-role="Carry">Carry</button>
      <button class="btn btn-outline-light filter-role" data-role="Support">Support</button>
      <button class="btn btn-outline-light filter-role" data-role="Nuker">Nuker</button>
      <button class="btn btn-outline-light filter-role" data-role="Disabler">Disabler</button>
    </div>

    <!-- Search -->
    <div class="d-flex justify-content-center mb-4">
      <input type="text" id="searchInput" class="form-control w-50" placeholder="Search heroes...">
    </div>

    <!-- Heroes Container -->
    <div id="hero-container" class="row"></div>
  </div>

  <script>
    const apiUrl = "https://api.opendota.com/api/heroes";
    const heroContainer = document.getElementById("hero-container");
    const searchInput = document.getElementById("searchInput");
    let heroesData = [];
    let currentAttr = null;
    let currentRole = null;
    let searchQuery = "";

    async function fetchHeroes() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        heroesData = data;
        applyFilters();
      } catch (error) {
        console.error("Failed to fetch heroes:", error);
        heroContainer.innerHTML = `<p class="text-danger">Failed to load heroes. Try again later.</p>`;
      }
    }

    function applyFilters() {
      let filtered = [...heroesData];

      if (currentAttr) {
        filtered = filtered.filter(h => h.primary_attr === currentAttr);
      }

      if (currentRole) {
        filtered = filtered.filter(h => h.roles.includes(currentRole));
      }

      if (searchQuery.trim() !== "") {
        filtered = filtered.filter(h =>
          h.localized_name.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }

      displayHeroes(filtered);
      updateFilterButtons();
    }

    function displayHeroes(heroes) {
      heroContainer.innerHTML = heroes.map(hero => `
        <div class="col-md-4 hero-card">
          <div class="card">
            <img src="assets/heroes/${hero.name.replace("npc_dota_hero_", "")}.png" class="card-img-top" alt="${hero.localized_name}">
            <div class="card-body">
              <h5 class="card-title">${hero.localized_name}</h5>
              <p class="card-text">
                <strong>Primary:</strong> ${hero.primary_attr === "all" ? "UNIVERSAL" : hero.primary_attr.toUpperCase()}<br>
                <strong>Attack:</strong> ${hero.attack_type}<br>
                <strong>Roles:</strong> ${hero.roles.join(", ")}
              </p>
            </div>
          </div>
        </div>
      `).join("");
    }

    function updateFilterButtons() {
      document.querySelectorAll(".filter-attr").forEach(btn => {
        btn.classList.remove("active");
        if (btn.dataset.attr === currentAttr) {
          btn.classList.add("active");
        }
      });

      document.querySelectorAll(".filter-role").forEach(btn => {
        btn.classList.remove("active");
        if (btn.dataset.role === currentRole) {
          btn.classList.add("active");
        }
      });
    }

    document.querySelectorAll(".filter-attr").forEach(btn => {
      btn.addEventListener("click", () => {
        currentAttr = btn.dataset.attr;
        applyFilters();
      });
    });

    document.querySelectorAll(".filter-role").forEach(btn => {
      btn.addEventListener("click", () => {
        currentRole = btn.dataset.role;
        applyFilters();
      });
    });

    document.querySelector(".reset-filters").addEventListener("click", () => {
      currentAttr = null;
      currentRole = null;
      searchQuery = "";
      searchInput.value = "";
      applyFilters();
    });

    searchInput.addEventListener("input", (e) => {
      searchQuery = e.target.value;
      applyFilters();
    });

    fetchHeroes();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register("service-worker.js")
          .then(reg => console.log("SW registered:", reg))
          .catch(err => console.error("SW failed:", err));
      });
    }
  </script>
</body>
</html>
